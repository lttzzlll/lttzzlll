---
layout: post
title: Python Celery
# gh-repo: lttzzlll/leetcode-java
# gh-badge: [star, fork, follow]
tags: [Python, Celery]
---

#### Celery: Distributed Task Queue 分布式消息队列

AMQP (Advanced Message Queue Protocol) 高级消息队列协议.

两个个关键词:

- 分布式
- 消息队列

摆脱了请求/响应，这种传统的使用方式。

四个部分

- Producer

Produce a task for the queue. 将生成的任务放入队列中。

- Broker

Store the task backlog. 存储积压的消息。

- RabbitMQ [the best choice in production stage]
- Redis
- SQLAlchemy
- Django's ORM [Don't use it in practice]
- MongoDB
- Amazon SQS
- CouchDB
- Beanstalk
- InroMQ

- Worker

Execute and consume tasks. 执行任务的单元。是真正的干活的。

Distributed.

- Result Backend

Store the result from our tasks. 用来存储任务完结时的结果。


#### Patterns and Best Practice

- Never pass objects as arguments. 传递参数时不要传对象。

- Keep tasks granual. Can process more in parallel. 保证任务细粒度。可以并发处理更多的任务。

- Avoid launching synchronous subtasks. 避免在一个任务中调用其他异步的子任务。

#### Periodic Tasks. 周期性任务。

#### Celery Beat A.K.A The Scheduler. 心跳机制(任务调度器)

- Never run a beat + worker on a single celery process. 不要让任务调度器运行在只有一个celery进程的机器上。

- Ensure a task is executed one at a time. 保证同一任务在同一时间只有一个在执行。